---
import env from "../../utils/env";
import { createToken } from "../../utils/token";

if (Astro.request.method !== "POST") {
    return Astro.redirect("/");
}

const req = Object.fromEntries(new URLSearchParams(await Astro.request.text()));
const token = createToken(req.username, req.password, env.maxAge);
console.log(token);
---

<script
    define:vars={{
        token,
        cookieName: env.cookieName,
        maxAge: env.maxAge
    }}
    is:inline
>
    if (token) {
        document.cookie = `${cookieName}=${token}; Max-Age=${maxAge}; path=/`;
    }
    window.location.href = "/";
</script>
